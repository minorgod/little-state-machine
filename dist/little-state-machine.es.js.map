{"version":3,"file":"little-state-machine.es.js","sources":["../src/constants.ts","../src/logic/storeFactory.ts","../src/context/index.tsx","../src/logic/createStore.tsx","../src/hooks/index.ts"],"sourcesContent":["export const STORE_DEFAULT_NAME = '__LSM__';\nexport const STORE_ACTION_NAME = '__LSM_NAME__';\nexport const PERSIST_OPTION = {\n  NONE: 'none',\n  ACTION: 'action',\n  UNLOAD: 'beforeUnload',\n} as const;\n","import { PERSIST_OPTION, STORE_DEFAULT_NAME } from '../constants';\nimport { GlobalState, StateMachineOptions } from '../types';\n\nfunction StoreFactory() {\n  let options: StateMachineOptions = {\n    name: STORE_DEFAULT_NAME,\n    middleWares: [],\n    persist: PERSIST_OPTION.ACTION,\n  };\n  let state: GlobalState = {};\n\n  try {\n    options.storageType =\n      typeof sessionStorage !== 'undefined' ? window.sessionStorage : undefined;\n  } catch {}\n\n  return {\n    updateStore(defaultValues: GlobalState) {\n      try {\n        state =\n          (options.storageType &&\n            JSON.parse(options.storageType.getItem(options.name!) || '')) ||\n          defaultValues;\n      } catch {\n        state = defaultValues;\n      }\n    },\n    saveStore() {\n      options.storageType &&\n        options.storageType.setItem(options.name!, JSON.stringify(state));\n    },\n    get state() {\n      return state;\n    },\n    set state(value) {\n      state = value;\n    },\n    get options() {\n      return options;\n    },\n    set options(value) {\n      options = value;\n    },\n  };\n}\n\nexport default StoreFactory();\n","'use client'; // needed for Next 13 compatibility\nimport * as React from 'react';\nimport storeFactory from '../logic/storeFactory';\nimport { StateMachineContextValue } from '../types';\nimport { PERSIST_OPTION } from '../constants';\n\nconst StateMachineContext = React.createContext<StateMachineContextValue>(\n  undefined as any,\n);\n\nexport const StateMachineProvider = ({ children } : React.PropsWithChildren) => {\n  const [state, setState] = React.useState(storeFactory.state);\n\n  React.useEffect(() => {\n    if (storeFactory.options.persist === PERSIST_OPTION.UNLOAD) {\n      window.onbeforeunload = () => storeFactory.saveStore();\n      storeFactory.options.storageType &&\n        storeFactory.options.storageType.removeItem(storeFactory.options.name!);\n    }\n  }, []);\n\n  return (\n    <StateMachineContext.Provider value={{ state, setState }}>\n      {children}\n    </StateMachineContext.Provider>\n  );\n};\n\nexport const useStateMachineContext = () =>\n  React.useContext<StateMachineContextValue>(StateMachineContext);\n","import storeFactory from './storeFactory';\nimport {\n  StateMachineOptions,\n  GlobalState,\n} from '../types';\n\nexport function createStore(\n  defaultState: GlobalState,\n  options?: StateMachineOptions,\n) {\n  if (options) {\n    storeFactory.options = {\n      ...storeFactory.options,\n      ...options,\n    };\n  }\n\n  if (process.env.NODE_ENV !== 'production') {\n    if (typeof window !== 'undefined') {\n      window.__LSM_NAME__ = storeFactory.options.name;\n      window.__LSM_RESET__ = () =>\n        storeFactory.options.storageType &&\n        storeFactory.options.storageType.removeItem(storeFactory.options.name!);\n    }\n  }\n\n  storeFactory.updateStore(defaultState);\n}\n","import {ActionsOutput, AnyActions, AnyCallback, GlobalState} from \"../types\";\nimport {useStateMachineContext} from \"../context\";\nimport * as React from \"react\";\nimport storeFactory from \"../logic/storeFactory\";\nimport {PERSIST_OPTION, STORE_ACTION_NAME} from \"../constants\";\n\n\nconst actionTemplate =\n    <TCallback extends AnyCallback>(\n        setState: React.Dispatch<React.SetStateAction<GlobalState>>,\n        callback: TCallback,\n    ) =>\n        (payload: Parameters<TCallback>[1], options?: { skipRender: boolean }) => {\n            if (process.env.NODE_ENV !== 'production') {\n                window[STORE_ACTION_NAME] = callback.name;\n            }\n\n            storeFactory.state = callback(storeFactory.state, payload);\n\n            if (storeFactory.options.middleWares) {\n                storeFactory.state = storeFactory.options.middleWares.reduce(\n                    (currentValue, currentFunction) =>\n                        currentFunction(currentValue, callback.name, payload) || currentValue,\n                    storeFactory.state,\n                );\n            }\n\n            (!options || !options.skipRender) && setState(storeFactory.state);\n\n            if (storeFactory.options.persist === PERSIST_OPTION.ACTION) {\n                storeFactory.saveStore();\n            }\n        };\nexport function useStateMachine<\n    TCallback extends AnyCallback,\n    TActions extends AnyActions<TCallback>,\n>(\n    actions?: TActions,\n): {\n    actions: ActionsOutput<TCallback, TActions>;\n    state: GlobalState;\n    getState: () => GlobalState;\n} {\n    const { state, setState } = useStateMachineContext();\n    const actionsRef = React.useRef(\n        Object.entries(actions || {}).reduce(\n            (previous, [key, callback]) =>\n                Object.assign({}, previous, {\n                    [key]: actionTemplate(setState, callback),\n                }),\n            {} as ActionsOutput<TCallback, TActions>,\n        ),\n    );\n\n    return {\n        actions: actionsRef.current,\n        state,\n        getState: React.useCallback(() => storeFactory.state, []),\n    };\n}\n"],"names":["PERSIST_OPTION","storeFactory","options","name","middleWares","persist","state","storageType","sessionStorage","window","undefined","_unused","updateStore","defaultValues","JSON","parse","getItem","_unused2","saveStore","setItem","stringify","value","StoreFactory","StateMachineContext","React","createContext","StateMachineProvider","_ref","children","_React$useState","useState","setState","useEffect","onbeforeunload","removeItem","createElement","Provider","useStateMachineContext","useContext","createStore","defaultState","_extends","process","env","NODE_ENV","__LSM_NAME__","__LSM_RESET__","useStateMachine","actions","_useStateMachineConte","actionsRef","useRef","Object","entries","reduce","previous","_Object$assign","assign","callback","payload","currentValue","currentFunction","skipRender","actionTemplate","current","getState","useCallback"],"mappings":"wBAAa,IAEAA,EAEH,SC0CVC,EA3CA,WACE,IAAIC,EAA+B,CACjCC,KDL8B,UCM9BC,YAAa,GACbC,QAASL,GAEPM,EAAqB,CAAA,EAEzB,IACEJ,EAAQK,YACoB,oBAAnBC,eAAiCC,OAAOD,oBAAiBE,CACnE,CAAC,MAAAC,IAEF,MAAO,CACLC,YAAW,SAACC,GACV,IACEP,EACGJ,EAAQK,aACPO,KAAKC,MAAMb,EAAQK,YAAYS,QAAQd,EAAQC,OAAU,KAC3DU,CACH,CAAC,MAAAI,GACAX,EAAQO,CACT,CACH,EACAK,UAASA,WACPhB,EAAQK,aACNL,EAAQK,YAAYY,QAAQjB,EAAQC,KAAOW,KAAKM,UAAUd,GAC9D,EACIA,YACF,OAAOA,CACT,EACIA,UAAMe,GACRf,EAAQe,CACV,EACInB,cACF,OAAOA,CACT,EACIA,YAAQmB,GACVnB,EAAUmB,CACZ,EAEJ,CAEeC,GCxCTC,EAAsBC,EAAMC,mBAChCf,GAGWgB,EAAuB,SAAHC,GAAM,IAAAC,EAAQD,EAARC,SACrCC,EAA0BL,EAAMM,SAAS7B,EAAaK,OAA/CA,EAAKuB,KAAEE,EAAQF,EAEtBL,GAQA,OARAA,EAAMQ,UAAU,WFRR,iBESF/B,EAAaC,QAAQG,UACvBI,OAAOwB,eAAiB,kBAAMhC,EAAaiB,WAAW,EACtDjB,EAAaC,QAAQK,aACnBN,EAAaC,QAAQK,YAAY2B,WAAWjC,EAAaC,QAAQC,MAEvE,EAAG,IAGDqB,EAACW,cAAAZ,EAAoBa,UAASf,MAAO,CAAEf,MAAAA,EAAOyB,SAAAA,IAC3CH,EAGP,EAEaS,EAAyB,kBACpCb,EAAMc,WAAqCf,EAAoB,sOCvBjD,SAAAgB,EACdC,EACAtC,GAEIA,IACFD,EAAaC,QAAOuC,EAAA,CAAA,EACfxC,EAAaC,QACbA,IAIsB,eAAzBwC,QAAQC,IAAIC,UACQ,oBAAXnC,SACTA,OAAOoC,aAAe5C,EAAaC,QAAQC,KAC3CM,OAAOqC,cAAgB,WAAA,OACrB7C,EAAaC,QAAQK,aACrBN,EAAaC,QAAQK,YAAY2B,WAAWjC,EAAaC,QAAQC,KAAM,GAI7EF,EAAaW,YAAY4B,EAC3B,CCMM,SAAUO,EAIZC,GAMA,IAAAC,EAA4BZ,IAApB/B,EAAK2C,EAAL3C,MAAOyB,EAAQkB,EAARlB,SACTmB,EAAa1B,EAAM2B,OACrBC,OAAOC,QAAQL,GAAW,CAAA,GAAIM,OAC1B,SAACC,EAAQ5B,GAAA6B,IAAAA,EAAgB,OACrBJ,OAAOK,OAAO,CAAE,EAAEF,IAAQC,EAAAA,CAAAA,GADf7B,EAAA,IAtCvB,SACII,EACA2B,GAAmB,OAElBC,SAAAA,EAAmCzD,GACH,eAAzBwC,QAAQC,IAAIC,WACZnC,OAAwB,aAAIiD,EAASvD,MAGzCF,EAAaK,MAAQoD,EAASzD,EAAaK,MAAOqD,GAE9C1D,EAAaC,QAAQE,cACrBH,EAAaK,MAAQL,EAAaC,QAAQE,YAAYkD,OAClD,SAACM,EAAcC,GAAe,OAC1BA,EAAgBD,EAAcF,EAASvD,KAAMwD,IAAYC,CAAY,EACzE3D,EAAaK,UAInBJ,IAAYA,EAAQ4D,aAAe/B,EAAS9B,EAAaK,OAEvDL,EAAaC,QAAQG,UAAYL,GACjCC,EAAaiB,WAErB,CAAC,CAgBkB6C,CAAehC,EAFLJ,EAAA,IAEwB6B,GAC3C,EACN,CAAA,IAIR,MAAO,CACHR,QAASE,EAAWc,QACpB1D,MAAAA,EACA2D,SAAUzC,EAAM0C,YAAY,WAAA,OAAMjE,EAAaK,KAAK,EAAE,IAE9D"}